// ============================================================
// Niri Window Rules — Comprehensive Edition
// Covers: floating dialogs, app sizing, opacity, security,
// screen capture exclusions, and per-app column widths.
// ============================================================


// ============================================================
// SECTION 1: GLOBAL VISUAL DEFAULTS
// Applies to every window unless overridden below.
// ============================================================

// Rounded corners for all windows (requires clip-to-geometry)
window-rule {
    geometry-corner-radius 12
    clip-to-geometry true
}


// ============================================================
// SECTION 2: FLOATING — MEDIA / PLAYERS
// ============================================================

// Browser Picture-in-Picture — all major browsers
window-rule {
    match app-id=r#"firefox$"# title="^Picture-in-Picture$"
    match app-id=r#"firefox$"# title="^Picture in Picture$"
    match app-id=r#"org\.mozilla\.firefox$"# title="^Picture-in-Picture$"
    match app-id=r#"google-chrome$"# title="^Picture in Picture$"
    match app-id=r#"chromium$"# title="^Picture in Picture$"
    match app-id=r#"vivaldi$"# title="^Picture in Picture$"
    open-floating true
    default-column-width { fixed 480; }
}

// Standalone media/image viewers
window-rule {
    match app-id="imv"
    match app-id="mpv"
    match app-id="vlc"
    match app-id="eog"
    open-floating true
}


// ============================================================
// SECTION 3: FLOATING — AUTHENTICATION & PORTALS
// ============================================================

window-rule {
    match app-id="polkit-gnome-authentication-agent-1"
    match app-id=r#"^org\.gnome\.Polkit"#
    match app-id="xdg-desktop-portal-gtk"
    match app-id="xdg-desktop-portal-gnome"
    match app-id="gnome-keyring-prompt"
    match app-id=r#"^gcr-"#
    open-floating true
}


// ============================================================
// SECTION 4: FLOATING — SYSTEM UTILITIES & APPLETS
// ============================================================

window-rule {
    match app-id="pavucontrol"
    match app-id="nm-connection-editor"
    match app-id="nm-applet"
    match app-id="blueman-manager"
    match app-id="blueman-applet"
    match app-id="gpartedbin"
    match app-id="copyq"
    match app-id="yad"
    match app-id="zenity"
    match app-id="xfce4-power-manager"
    match app-id="xfce4-notifyd"
    match app-id="xfsettingsd"
    open-floating true
}

// Bluetooth / network quick-dialogs (by title pattern)
window-rule {
    match title=r#"^(Bluetooth|Network|Wi-Fi|Wireless).*"#
    open-floating true
}


// ============================================================
// SECTION 5: FLOATING — GNOME NAUTILUS FILE PICKER
// (Only picker dialogs, not the main file manager window)
// ============================================================

window-rule {
    match app-id="org.gnome.NautilusPreviewer"
    match title="^Open Files$"
    match title="^Select Files$"
    match title="^Save As$"
    open-floating true
}


// ============================================================
// SECTION 6: FLOATING — SMALL TOOL WINDOWS
// ============================================================

window-rule {
    match app-id="swappy"
    match app-id="flameshot"
    match app-id="ksnip"
    match app-id="slurp"
    open-floating true
}

// KDE / GTK file/color/font pickers (appear as transients)
window-rule {
    match title="^(Open|Save|Choose|Select|Pick|Color|Font).*"
    match is-dialog true
    open-floating true
}

// All generic dialog windows (transients)
window-rule {
    match is-dialog true
    open-floating true
}


// ============================================================
// SECTION 7: APPLICATION LAYOUT — COLUMN WIDTHS
// Tuned per-app to make the most of horizontal space.
// ============================================================

// File manager — narrow browser-style panel
window-rule {
    match app-id="org.gnome.Nautilus"
    match app-id="nautilus"
    default-column-width { proportion 0.35; }
}

// Browsers — comfortable reading width
window-rule {
    match app-id=r#"firefox$"#
    match app-id=r#"org\.mozilla\.firefox$"#
    match app-id=r#"google-chrome$"#
    match app-id=r#"vivaldi$"#
    match app-id=r#"chromium$"#
    default-column-width { proportion 0.6; }
}

// Code editors / IDEs — wide for code
window-rule {
    match app-id=r#"code(-url-handler)?$"#
    match app-id="cursor"
    match app-id=r#"^windsurf"#
    match app-id=r#"^zed"#
    match app-id="antigravity"
    default-column-width { proportion 0.65; }
}

// API / DB / Dev tools
window-rule {
    match app-id="postman"
    match app-id=r#"mongodb-compass"#
    default-column-width { proportion 0.6; }
}

// Kubernetes / container management tools
window-rule {
    match app-id=r#"freelens"#
    default-column-width { proportion 0.75; }
}

// VM manager — wide for console output
window-rule {
    match app-id="virt-manager"
    match app-id=r#"^quickgui"#
    default-column-width { proportion 0.65; }
}

// GNS3 network topology — needs space
window-rule {
    match app-id=r#"^gns3"#
    default-column-width { proportion 0.8; }
}

// Terminal emulator — medium width
window-rule {
    match app-id="Alacritty"
    match app-id="alacritty"
    match app-id=r#"^org\.wezfurlong\.wezterm$"#
    default-column-width { proportion 0.5; }
}

// Wireshark / network analysis
window-rule {
    match app-id=r#"^wireshark"#
    match app-id=r#"^termshark"#
    default-column-width { proportion 0.75; }
}

// Media editors (Kdenlive, Audacity-like)
window-rule {
    match app-id=r#"^kdenlive"#
    match app-id=r#"^qtractor"#
    default-column-width { proportion 0.8; }
}

// Image editors
window-rule {
    match app-id="gimp"
    match app-id="inkscape"
    default-column-width { proportion 0.7; }
}

// Logseq / note-taking
window-rule {
    match app-id=r#"^logseq"#
    default-column-width { proportion 0.55; }
}

// OBS Studio (broadcast / recording)
window-rule {
    match app-id=r#"^com\.obsproject"#
    match app-id="obs"
    default-column-width { proportion 0.7; }
}

// Remote desktop / VNC clients
window-rule {
    match app-id="remmina"
    match app-id="org.remmina.Remmina"
    default-column-width { proportion 0.65; }
}

// Disk utility - narrow
window-rule {
    match app-id=r#"^org\.gnome\.DiskUtility"#
    match app-id="gnome-disks"
    default-column-width { proportion 0.45; }
}


// ============================================================
// SECTION 8: VISUAL ENHANCEMENTS — OPACITY
// ============================================================

// Terminal emulators — slight transparency for elegance
window-rule {
    match app-id="Alacritty"
    match app-id="alacritty"
    match app-id=r#"^org\.wezfurlong\.wezterm$"#
    opacity 0.94
}

// Fuzzel launcher — no special opacity needed (handles itself)
// Notification daemon — let swaync manage its own styling


// ============================================================
// SECTION 9: SECURITY — SCREEN CAPTURE EXCLUSIONS
// Prevents sensitive windows from appearing in recordings/casts.
// ============================================================

window-rule {
    match app-id=r#"^1Password"#
    match app-id="bitwarden"
    match app-id=r#"^gnome-keyring"#
    match app-id=r#"^gcr-prompter"#
    match app-id="polkit-gnome-authentication-agent-1"
    // Use "screencast" to only exclude from casts (not screenshots).
    block-out-from "screen-capture"
}

// Lock screen — never capture
window-rule {
    match app-id="swaylock"
    match app-id=r#"^hyprlock"#
    block-out-from "screen-capture"
}


// ============================================================
// SECTION 10: APP-SPECIFIC QUIRKS
// ============================================================

// WezTerm: reset initial width to avoid the configure-race bug
window-rule {
    match app-id=r#"^org\.wezfurlong\.wezterm$"#
    default-column-width {}
}

// TeamViewer: always float, may open odd-sized windows
window-rule {
    match app-id=r#"^TeamViewer"#
    match app-id="teamviewer"
    open-floating true
}

// AnyDesk: float for remote desktop helper windows
window-rule {
    match app-id=r#"^anydesk"#
    open-floating true
}

// Burp Suite / security GUIs: keep floating for tool panels
window-rule {
    match app-id=r#"^burpsuite"#
    open-floating true
}

// CopyQ menu popup: always float, no decorations
window-rule {
    match app-id="com.github.hluk.copyq"
    open-floating true
}

// Qbittorrent: medium width
window-rule {
    match app-id=r#"^qbittorrent"#
    default-column-width { proportion 0.55; }
}

// Ollama / AI CLI processes — no GUI windows, no rules needed
